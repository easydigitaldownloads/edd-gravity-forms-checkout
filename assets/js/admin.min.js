jQuery(document).ready(function($){var e=e||{debug:!1,init:function(){var o=e;$(document).on("gform_load_field_settings",o.hide_connect_for_options),$("body").on("change","#field_edd_download",o.change_download),$("body").on("show change","#product_field,#product_field_type",o.maybe_show_variations),$("body").on("mouseup keyup",".edd-gf-get-variations button",o.get_variations)},log:function(o,d){e.debug&&(d=d||null,console.log(o,d))},hide_connect_for_options:function(){var o=GetSelectedField();"product"!==o.type&&"option"!==o.type&&e.product_hide_all(o)},update_field_choices:function(e){UpdateFieldChoices(e.type),LoadFieldChoices(e)},get_product_field:function(o){if("undefined"==typeof o.type||"product"!==o.type&&"option"!==o.type)return e.log("not a product field",o),!1;var d=!1;return d="undefined"==typeof o.productField||""===o.productField?o:GetFieldById(o.productField)},get_variations:function(o){var d=e;if("keyup"===o.type&&32!==o.keyCode&&13!==o.keyCode)return void d.log("keyCode not space or return.",o.keyCode);var i=GetSelectedField(),t=d.get_product_field(i),n=t?t.eddDownload:"";$(".edd-gf-loading").show(),d.log("in edd-gf-get-variations",{field:i,edd_gf_selected_download:n,eddProductField:t}),$.post(ajaxurl,{action:"edd_gf_check_for_variations",download_id:n,nonce:$("#edd_gf_download_nonce").val(),format:"json"}).done(function(e){d.log("Check For Variations Data",e),$(".edd-gf-loading").hide();var o=jQuery.parseJSON(e);d.log("parsed JSON price Variable Items",o),0===o.length?(d.log("There were no variations. Reverting to original field choices."),d.restore_field_choices(i)):(i.eddChoicesBackup=i.choices,i.choices=[],$("#field_choice_values_enabled").prop("checked",!0),SetFieldProperty("enableChoiceValue",!0),ToggleChoiceValue(),SetFieldChoices(),$.each(o,function(e,o){var d=GetCurrentCurrency(),t=d.toMoney(o.amount),n=new Choice;n.text=o.name,n.value=e.toString(),n.price=t,n.isSelected=!1,i.choices.push(n)}),d.update_field_choices(i))}).error(function(e){$(".edd-gf-loading").hide(),d.log("Error loading variations",e)})},maybe_show_variations:function(o){var d=e,i=GetSelectedField(),t=d.get_product_field(i),n=t?t.eddDownload:"";$("#gfield_settings_choices_container .gfield_choice_header_value").text(EDDGF.text_value),d.log("#"+$(o.target).attr("id")+" "+o.type,{event:o,field:i,edd_gf_selected_download:n,eddProductField:t}),""===n||"0"===n?d.product_hide_all(i):t.eddHasVariables?d.product_has_variables(i):d.product_has_no_variables(i)},product_hide_all:function(o){$(".product-has-variations-message").hide(),$(".edd_gf_connect_variations").slideUp(100),e.restore_field_choices(o)},product_has_variables:function(o){return e.log("product_has_variables"),$(".edd-gf-get-variations").show(),$(".product-has-variations-message").show(),$(".edd-gf-no-variations-warning").hide(),$(".product-add-option-field").hide(),o.productField=o.productField||"",""===o.productField&&"radio"!==o.inputType&&"select"!==o.inputType?($(".edd_gf_connect_variations").hide(),void $(".product-add-option-field").show()):($("#gfield_settings_choices_container .gfield_choice_header_value").text(EDDGF.text_price_id),void $(".edd_gf_connect_variations:hidden").slideDown("fast"))},product_has_no_variables:function(o){e.log("product_has_no_variables"),$(".edd-gf-no-variations-warning").hide(),$(".product-has-variations-message").hide(),$(".edd-gf-get-variations").hide(),""!==o.productField?($(".edd-gf-no-variations-warning").show(),$(".edd_gf_connect_variations:hidden").slideDown("fast")):"radio"===o.inputType||"select"===o.inputType?($(".edd-gf-no-variations-warning").show(),$(".edd_gf_connect_variations:hidden").slideDown("fast")):$(".edd_gf_connect_variations").hide(),e.restore_field_choices(o)},restore_field_choices:function(o){e.log("In edd_gf_restore_field_choices"),o.eddChoicesBackup?o.choices=o.eddChoicesBackup:"undefined"==typeof o.choices&&(o.choices=[new Choice("First Option","","0.00"),new Choice("Second Option","","0.00"),new Choice("Third Option","","0.00")]),e.update_field_choices(o),e.log("field",o)},change_download:function(o){var d=e,i=$("option:selected",this).val();SetFieldProperty("eddDownload",i),SetFieldProperty("eddHasVariables",!1),$.isNumeric(i)&&0!==parseInt(i,10)&&$("option:selected",$(this)).attr("data-variations")&&SetFieldProperty("eddHasVariables",!0),d.maybe_show_variations(o)}};e.init()});