\hypertarget{class_k_w_s___g_f___e_d_d}{\section{K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D Class Reference}
\label{class_k_w_s___g_f___e_d_d}\index{K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D@{K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D}}
}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{class_k_w_s___g_f___e_d_d_a285db2e0469dc1da689cf4554f7b4ac7}{\-\_\-\-\_\-construct} ()
\item 
\hyperlink{class_k_w_s___g_f___e_d_d_a4d58c6b349b4a2dd52d509efb3300adc}{init} ()
\item 
\hyperlink{class_k_w_s___g_f___e_d_d_aa718a24cb749c979ed56e798a7e9ae52}{get\-\_\-payment\-\_\-status\-\_\-from\-\_\-gf\-\_\-status} (\$status)
\item 
\hyperlink{class_k_w_s___g_f___e_d_d_a988bc1f1b9b53450e5df93c031e5e4cf}{get\-\_\-download\-\_\-options\-\_\-from\-\_\-entry} (\$entry, \$field, \$download\-\_\-id, \$field\-\_\-id)
\item 
\hyperlink{class_k_w_s___g_f___e_d_d_a957f6050e92f37a0c11d9350a32accdd}{get\-\_\-edd\-\_\-data\-\_\-array\-\_\-from\-\_\-entry} (\$entry, \$form)
\item 
\hyperlink{class_k_w_s___g_f___e_d_d_a9b3c8c5490e780bed64e4ccbe9ce913c}{send\-\_\-purchase\-\_\-to\-\_\-edd} (\$entry=null, \$form)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Plugin Name\-: Gravity Forms Checkout for Easy Digital Downloads Plugin U\-R\-I\-: \href{http://katz.co/downloads/edd-gf/}{\tt http\-://katz.\-co/downloads/edd-\/gf/} Description\-: Integrate Gravity Forms purchases with Easy Digital Downloads Author\-: Katz Web Services, Inc. Version\-: 1.\-0 Requires at least\-: 3.\-0 Author U\-R\-I\-: \href{http://katz.co}{\tt http\-://katz.\-co} License\-: G\-P\-L v3 Text Domain\-: edd-\/gf Domain Path\-: languages 

\subsection{Constructor \& Destructor Documentation}
\hypertarget{class_k_w_s___g_f___e_d_d_a285db2e0469dc1da689cf4554f7b4ac7}{\index{K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D@{K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D}!\-\_\-\-\_\-construct@{\-\_\-\-\_\-construct}}
\index{\-\_\-\-\_\-construct@{\-\_\-\-\_\-construct}!KWS_GF_EDD@{K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D}}
\subsubsection[{\-\_\-\-\_\-construct}]{\setlength{\rightskip}{0pt plus 5cm}K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D\-::\-\_\-\-\_\-construct (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{class_k_w_s___g_f___e_d_d_a285db2e0469dc1da689cf4554f7b4ac7}
Set constants, load textdomain, and trigger \hyperlink{class_k_w_s___g_f___e_d_d_a4d58c6b349b4a2dd52d509efb3300adc}{init()}  \hyperlink{class_k_w_s___g_f___e_d_d_a4d58c6b349b4a2dd52d509efb3300adc}{K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D\-::init()} 
\begin{DoxyCode}
41                            \{
42 
43         \textcolor{keywordflow}{if}(!defined(\textcolor{stringliteral}{'EDD\_GF\_PLUGIN\_FILE'})) \{
44             define(\textcolor{stringliteral}{'EDD\_GF\_PLUGIN\_FILE'}, \_\_FILE\_\_ );
45         \}
46         \textcolor{keywordflow}{if}(!defined(\textcolor{stringliteral}{'EDD\_GF\_PLUGIN\_URL'})) \{
47             define(\textcolor{stringliteral}{'EDD\_GF\_PLUGIN\_URL'}, plugins\_url( \textcolor{stringliteral}{''}, \_\_FILE\_\_ ));
48         \}
49         \textcolor{keywordflow}{if}(!defined(\textcolor{stringliteral}{'EDD\_GF\_PLUGIN\_DIR'})) \{
50             define( \textcolor{stringliteral}{'EDD\_GF\_PLUGIN\_DIR'}, plugin\_dir\_path( \_\_FILE\_\_ ) );
51         \}
52 
53         \textcolor{comment}{// Load the default language files}
54         load\_plugin\_textdomain( \textcolor{stringliteral}{'edd-gf'}, \textcolor{keyword}{false}, dirname( plugin\_basename( EDD\_GF\_PLUGIN\_FILE ) ) . \textcolor{stringliteral}{'
      /languages/'} );
55 
56         $this->\hyperlink{class_k_w_s___g_f___e_d_d_a4d58c6b349b4a2dd52d509efb3300adc}{init}();
57     \}
\end{DoxyCode}


\subsection{Member Function Documentation}
\hypertarget{class_k_w_s___g_f___e_d_d_a988bc1f1b9b53450e5df93c031e5e4cf}{\index{K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D@{K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D}!get\-\_\-download\-\_\-options\-\_\-from\-\_\-entry@{get\-\_\-download\-\_\-options\-\_\-from\-\_\-entry}}
\index{get\-\_\-download\-\_\-options\-\_\-from\-\_\-entry@{get\-\_\-download\-\_\-options\-\_\-from\-\_\-entry}!KWS_GF_EDD@{K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D}}
\subsubsection[{get\-\_\-download\-\_\-options\-\_\-from\-\_\-entry}]{\setlength{\rightskip}{0pt plus 5cm}K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D\-::get\-\_\-download\-\_\-options\-\_\-from\-\_\-entry (
\begin{DoxyParamCaption}
\item[{}]{\$entry, }
\item[{}]{\$field, }
\item[{}]{\$download\-\_\-id, }
\item[{}]{\$field\-\_\-id}
\end{DoxyParamCaption}
)}}\label{class_k_w_s___g_f___e_d_d_a988bc1f1b9b53450e5df93c031e5e4cf}
Returns an {\ttfamily options} array for a download with variations.

This takes the submitted entry, the original G\-F form, and the E\-D\-D price variations and searches for matches to the price I\-D and the related amounts.


\begin{DoxyParams}[1]{Parameters}
array & {\em \$entry} & G\-F Entry array \\
\hline
array & {\em \$field} & G\-F Field array \\
\hline
int & {\em \$download\-\_\-id} & The Download I\-D of the parent E\-D\-D download \\
\hline
float | int & {\em \$field\-\_\-id} & The I\-D of the current field being processed \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
array An associative array with {\ttfamily amount} and {\ttfamily price\-\_\-id} keys. 
\end{DoxyReturn}

\begin{DoxyCode}
112                                                                                       \{
113 
114         $options = NULL;
115 
116         \textcolor{comment}{// Get the variations for the product}
117         \textcolor{keywordflow}{if}($prices = edd\_get\_variable\_prices($download\_id)) \{
118 
119             $this->r($prices, \textcolor{keyword}{false}, \textcolor{stringliteral}{'$prices, '}.\_\_LINE\_\_);
120 
121             $options = array(); \textcolor{comment}{// Default options array}
122 
123             \textcolor{comment}{// Gravity Forms passes field value and price imploded with a "|" in the "\{value\}|\{price\}"
       format.}
124             list($submitted\_price\_id\_or\_label, $submitted\_price) = explode(\textcolor{charliteral}{'|'}, $entry[\textcolor{stringliteral}{"\{$field\_id\}"}]);
125 
126             \textcolor{keywordflow}{if}(empty($submitted\_price)) \{
127                 $this->r($field\_id, \textcolor{keyword}{false}, \textcolor{stringliteral}{'$field\_id'});
128                 $this->r($entry);
129             \}
130 
131             \textcolor{comment}{// Use the submitted price instead of any other.}
132             $options[\textcolor{stringliteral}{'amount'}] = GFCommon::to\_number($submitted\_price);
133 
134             \textcolor{comment}{// We loop through the download variable prices from EDD}
135             \textcolor{keywordflow}{foreach} ($prices as $price\_id => $price\_details) \{
136 
137                 \textcolor{comment}{// If the $price\_id matches the value, we're good.}
138                 \textcolor{keywordflow}{if}(intval($submitted\_price\_id\_or\_label) === intval($price\_id)) \{
139                     $options[\textcolor{stringliteral}{'price\_id'}] = $price\_id;
140                     \textcolor{keywordflow}{break}; \textcolor{comment}{// Stop looking}
141                 \}
142 
143                 \textcolor{comment}{// If the name is the same, then we're good too.}
144                 \textcolor{keywordflow}{foreach} ($field[\textcolor{stringliteral}{'choices'}] as $choice) \{
145 
146                     \textcolor{comment}{// If the EDD variation name is in the Gravity Forms choice array,}
147                     \textcolor{comment}{// that means that it's either in the `text` or `value` fields, so}
148                     \textcolor{comment}{// we go with that.}
149                     \textcolor{keywordflow}{if}(in\_array($price\_details[\textcolor{stringliteral}{'name'}], $choice)) \{
150                         $options[\textcolor{stringliteral}{'price\_id'}] = $price\_id;
151                         \textcolor{keywordflow}{break}; \textcolor{comment}{// Stop looking}
152                     \}
153                 \}
154 
155             \}
156         \}
157 
158         \textcolor{keywordflow}{return} $options;
159     \}
\end{DoxyCode}
\hypertarget{class_k_w_s___g_f___e_d_d_a957f6050e92f37a0c11d9350a32accdd}{\index{K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D@{K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D}!get\-\_\-edd\-\_\-data\-\_\-array\-\_\-from\-\_\-entry@{get\-\_\-edd\-\_\-data\-\_\-array\-\_\-from\-\_\-entry}}
\index{get\-\_\-edd\-\_\-data\-\_\-array\-\_\-from\-\_\-entry@{get\-\_\-edd\-\_\-data\-\_\-array\-\_\-from\-\_\-entry}!KWS_GF_EDD@{K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D}}
\subsubsection[{get\-\_\-edd\-\_\-data\-\_\-array\-\_\-from\-\_\-entry}]{\setlength{\rightskip}{0pt plus 5cm}K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D\-::get\-\_\-edd\-\_\-data\-\_\-array\-\_\-from\-\_\-entry (
\begin{DoxyParamCaption}
\item[{}]{\$entry, }
\item[{}]{\$form}
\end{DoxyParamCaption}
)}}\label{class_k_w_s___g_f___e_d_d_a957f6050e92f37a0c11d9350a32accdd}
Take the submitted G\-F entry and form and generate an array of data for a new E\-D\-D order

This is the work horse for the plugin. It processes an array with the keys\-: {\ttfamily cart\-\_\-details}, {\ttfamily user\-\_\-info}, {\ttfamily downloads}.


\begin{DoxyParams}[1]{Parameters}
array & {\em \$entry} & G\-F Entry array \\
\hline
array & {\em \$form} & G\-F Form array \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
array Associative array with keys {\ttfamily cart\-\_\-details}, {\ttfamily user\-\_\-info}, {\ttfamily downloads} 
\end{DoxyReturn}

\begin{DoxyCode}
170                                                           \{
171 
172         $data = $downloads = $user\_info = $cart\_details = array();
173 
174         \textcolor{keywordflow}{foreach} ($form[\textcolor{stringliteral}{'fields'}] as $field) \{
175 
176             \textcolor{keywordflow}{switch}($field[\textcolor{stringliteral}{'type'}]) \{
177                 \textcolor{keywordflow}{case} \textcolor{stringliteral}{'product'}:
178 
179                     \textcolor{comment}{// Only process connected products that don't have variable prices.}
180                     \textcolor{keywordflow}{if}(empty($field[\textcolor{stringliteral}{'eddDownload'}]) || !empty($field[\textcolor{stringliteral}{'eddHasVariables'}])) \{ \textcolor{keywordflow}{continue}; \}
181 
182                     \textcolor{keywordflow}{if}($field[\textcolor{stringliteral}{'inputType'}] === \textcolor{stringliteral}{'singleproduct'}) \{
183                         $downloads[] = array(
184                             \textcolor{stringliteral}{'id'} => $field[\textcolor{stringliteral}{'eddDownload'}],
185                             \textcolor{stringliteral}{'name'} => $entry[\textcolor{stringliteral}{"\{$field['id']\}.1"}],
186                             \textcolor{stringliteral}{'price'} => $entry[\textcolor{stringliteral}{"\{$field['id']\}.2"}],
187                             \textcolor{stringliteral}{'quantity'} => $entry[\textcolor{stringliteral}{"\{$field['id']\}.3"}],
188                         );
189                     \}
190                     \textcolor{keywordflow}{break};
191 
192                 \textcolor{comment}{// Product Options field for product variations}
193                 \textcolor{keywordflow}{case} \textcolor{stringliteral}{'option'}:
194 
195                     \textcolor{comment}{// The parent ID should be set and not zero if it's connected to an EDD product.}
196                     \textcolor{keywordflow}{if}(empty($field[\textcolor{stringliteral}{'eddVariationParentID'}])) \{ \textcolor{keywordflow}{continue}; \}
197 
198                     \textcolor{comment}{// The ID of the variation's parent product}
199                     $parentID = absint( $field[\textcolor{stringliteral}{'eddVariationParentID'}] );
200 
201                     \textcolor{comment}{// There are different types of options fields:}
202                     \textcolor{comment}{// Drop Down (select), Radio, and Checkboxes}
203                     \textcolor{keywordflow}{switch}($field[\textcolor{stringliteral}{'inputType'}]) \{
204                         \textcolor{keywordflow}{case} \textcolor{stringliteral}{'checkbox'}:
205                             \textcolor{keywordflow}{foreach}($field[\textcolor{stringliteral}{'inputs'}] as $input) \{
206                                 $downloads[] = array(
207                                     \textcolor{stringliteral}{'id'} => $parentID,
208                                     \textcolor{stringliteral}{'name'} => $input[\textcolor{stringliteral}{'label'}],
209                                     \textcolor{stringliteral}{'quantity'} => $entry[\textcolor{stringliteral}{"\{$field['productField']\}.3"}],
210                                     \textcolor{stringliteral}{'options'} => $this->
      \hyperlink{class_k_w_s___g_f___e_d_d_a988bc1f1b9b53450e5df93c031e5e4cf}{get\_download\_options\_from\_entry}($entry, $field, $parentID, $input[\textcolor{stringliteral}{'id'}])
211                                 );
212                             \}
213                             \textcolor{keywordflow}{break};
214                         \textcolor{keywordflow}{default}:
215                             $parentField = GFFormsModel::get\_field($form, $field[\textcolor{stringliteral}{'productField'}]);
216                             $downloads[] = array(
217                                 \textcolor{stringliteral}{'id'} => $parentID,
218                                 \textcolor{stringliteral}{'quantity'} => $entry[\textcolor{stringliteral}{"\{$parentField['id']\}.3"}],
219                                 \textcolor{stringliteral}{'options'} => $this->
      \hyperlink{class_k_w_s___g_f___e_d_d_a988bc1f1b9b53450e5df93c031e5e4cf}{get\_download\_options\_from\_entry}($entry, $field, $parentID, $field[\textcolor{stringliteral}{'id'}])
220                             );
221                             \textcolor{keywordflow}{break};
222                     \}
223                     \textcolor{keywordflow}{break};
224                 \textcolor{keywordflow}{case} \textcolor{stringliteral}{'email'}:
225                     $user\_info[\textcolor{stringliteral}{'email'}] = $field[\textcolor{stringliteral}{'id'}];
226                     \textcolor{keywordflow}{break};
227                 \textcolor{keywordflow}{case} \textcolor{stringliteral}{'name'}:
228                     \textcolor{keywordflow}{foreach} ($field[\textcolor{stringliteral}{'inputs'}] as $input) \{
229                         \textcolor{keywordflow}{if}(floatval($input[\textcolor{stringliteral}{'id'}]) === floatval($field[\textcolor{stringliteral}{'id'}].\textcolor{stringliteral}{'.3'})) \{
230                             $user\_info[\textcolor{stringliteral}{'first\_name'}] = $input[\textcolor{stringliteral}{'id'}];
231                         \}
232                         \textcolor{keywordflow}{if}(floatval($input[\textcolor{stringliteral}{'id'}]) === floatval($field[\textcolor{stringliteral}{'id'}].\textcolor{stringliteral}{'.6'})) \{
233                             $user\_info[\textcolor{stringliteral}{'last\_name'}] = $input[\textcolor{stringliteral}{'id'}];
234                         \}
235                     \}
236                     \textcolor{keywordflow}{break};
237             \}
238         \}
239 
240 
241         \textcolor{comment}{/*// Setup user information}
242 \textcolor{comment}{        if(is\_user\_logged\_in()) \{}
243 \textcolor{comment}{            $user\_info = array(}
244 \textcolor{comment}{                'id'         => get\_current\_user\_id(),}
245 \textcolor{comment}{                'email'      => $current\_user->user\_email,}
246 \textcolor{comment}{                'first\_name' => $current\_user->user\_firstname,}
247 \textcolor{comment}{                'last\_name'  => $current\_user->user\_lastname,}
248 \textcolor{comment}{                'discount'   => '',}
249 \textcolor{comment}{                'address'    => array()}
250 \textcolor{comment}{            );}
251 \textcolor{comment}{        \}*/}
252 
253         \textcolor{comment}{// Convert the Gravity Forms Field ID keys into Entry values}
254         \textcolor{keywordflow}{foreach} ($user\_info as $key => $entry\_key) \{
255             $user\_info[$key] = $entry[\textcolor{stringliteral}{"\{$entry\_key\}"}];
256         \}
257 
258         \textcolor{comment}{// Get user by email}
259         $user\_id = -1;
260         \textcolor{keywordflow}{if}(!empty($user\_info[\textcolor{stringliteral}{'email'}])) \{
261 
262             $wp\_user = get\_user\_by( \textcolor{stringliteral}{'email'}, $user\_info[\textcolor{stringliteral}{'email'}] );
263 
264             \textcolor{comment}{// Then get user ID, if user exists}
265             $user\_id = $wp\_user ? $wp\_user->ID : $user\_id;
266         \}
267 
268         \textcolor{comment}{// Set user data array}
269         $user\_info = array(
270             \textcolor{stringliteral}{'id'}         => $user\_id,
271             \textcolor{stringliteral}{'email'}      => $user\_info[\textcolor{stringliteral}{'email'}],
272             \textcolor{stringliteral}{'first\_name'} => $user\_info[\textcolor{stringliteral}{'first\_name'}],
273             \textcolor{stringliteral}{'last\_name'}  => $user\_info[\textcolor{stringliteral}{'last\_name'}],
274             \textcolor{stringliteral}{'discount'}   => \textcolor{stringliteral}{''}
275         );
276 
277         \textcolor{keywordflow}{foreach}( $downloads as $download ) \{
278 
279             \textcolor{comment}{// When buying multiple products with price variants,}
280             \textcolor{comment}{// we pass the download id as "\{$download\_id\}.\{$gf\_input\_id\}" so}
281             \textcolor{comment}{// the array key doesn't get overwritten.}
282             $download\_id = absint($download[\textcolor{stringliteral}{'id'}]);
283 
284             \textcolor{comment}{// Referenced from `edd\_update\_payment\_details()` in functions.php}
285             $item = array(
286                 \textcolor{stringliteral}{'id'}        => $download\_id,
287                 \textcolor{stringliteral}{'quantity'}  => absint( $download[\textcolor{stringliteral}{'quantity'}] ),
288             );
289 
290             \textcolor{comment}{// If there's price ID data, use it}
291             \textcolor{keywordflow}{if}( isset($download[\textcolor{stringliteral}{'options'}]) ) \{
292                 $item[\textcolor{stringliteral}{'options'}] = $download[\textcolor{stringliteral}{'options'}];
293             \}
294 
295             $cart\_details[] = array(
296                 \textcolor{stringliteral}{'name'}        => get\_the\_title( $download\_id ),
297                 \textcolor{stringliteral}{'id'}          => $download\_id,
298                 \textcolor{stringliteral}{'item\_number'} => $item,
299                 \textcolor{stringliteral}{'price'}       => isset($download[\textcolor{stringliteral}{'price'}]) ? GFCommon::to\_number($download[\textcolor{stringliteral}{'price'}]) : 
      GFCommon::to\_number($item[\textcolor{stringliteral}{'options'}][\textcolor{stringliteral}{'amount'}]),
300                 \textcolor{stringliteral}{'tax'}         => NULL,
301                 \textcolor{stringliteral}{'quantity'}    => absint( $download[\textcolor{stringliteral}{'quantity'}] ),
302             );
303 
304         \}
305 
306         $this->r($downloads, \textcolor{keyword}{false}, \textcolor{stringliteral}{'Downloads after generating Cart Details ('}.\_\_LINE\_\_.\textcolor{charliteral}{')'});
307 
308         $data[\textcolor{stringliteral}{'downloads'}] = $downloads;
309         $data[\textcolor{stringliteral}{'user\_info'}] = $user\_info;
310         $data[\textcolor{stringliteral}{'cart\_details'}] = $cart\_details;
311 
312         \textcolor{keywordflow}{return} $data;
313     \}
\end{DoxyCode}
\hypertarget{class_k_w_s___g_f___e_d_d_aa718a24cb749c979ed56e798a7e9ae52}{\index{K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D@{K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D}!get\-\_\-payment\-\_\-status\-\_\-from\-\_\-gf\-\_\-status@{get\-\_\-payment\-\_\-status\-\_\-from\-\_\-gf\-\_\-status}}
\index{get\-\_\-payment\-\_\-status\-\_\-from\-\_\-gf\-\_\-status@{get\-\_\-payment\-\_\-status\-\_\-from\-\_\-gf\-\_\-status}!KWS_GF_EDD@{K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D}}
\subsubsection[{get\-\_\-payment\-\_\-status\-\_\-from\-\_\-gf\-\_\-status}]{\setlength{\rightskip}{0pt plus 5cm}K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D\-::get\-\_\-payment\-\_\-status\-\_\-from\-\_\-gf\-\_\-status (
\begin{DoxyParamCaption}
\item[{}]{\$status}
\end{DoxyParamCaption}
)}}\label{class_k_w_s___g_f___e_d_d_aa718a24cb749c979ed56e798a7e9ae52}
Make G\-F and E\-D\-D statuses match \begin{DoxyReturn}{Returns}
array Existing statuses  edd\-\_\-gf\-\_\-default\-\_\-status Modify the default status when there's no status match. Default\-: {\ttfamily pending}. Passes default and {\ttfamily \$status} arguments.  edd\-\_\-gf\-\_\-payment\-\_\-status Override the status when there is a match. Passes matched value and {\ttfamily \$status} arguments. 
\end{DoxyReturn}
\begin{DoxyRefDesc}{Todo}
\item[\hyperlink{todo__todo000001}{Todo}]Ensure the default status is right when there's no status match. \end{DoxyRefDesc}

\begin{DoxyCode}
77                                                                \{
78 
79         $gf\_payment\_statuses = array(
80 
81             \textcolor{stringliteral}{"Processing"} => \textcolor{stringliteral}{'pending'},
82             \textcolor{stringliteral}{"Pending"} => \textcolor{stringliteral}{'pending'},
83 
84             \textcolor{stringliteral}{"Active"} => \textcolor{stringliteral}{'publish'},
85             \textcolor{stringliteral}{"Approved"} => \textcolor{stringliteral}{'publish'},
86 
87             \textcolor{stringliteral}{"Expired"} => \textcolor{stringliteral}{'revoked'},
88 
89             \textcolor{stringliteral}{"Failed"} => \textcolor{stringliteral}{'failed'},
90             \textcolor{stringliteral}{"Cancelled"} => \textcolor{stringliteral}{'failed'},
91 
92             \textcolor{stringliteral}{"Reversed"} => \textcolor{stringliteral}{'refunded'},
93             \textcolor{stringliteral}{"Refunded"} => \textcolor{stringliteral}{'refunded'},
94             \textcolor{stringliteral}{"Voided"} => \textcolor{stringliteral}{'refunded'},
95         );
96 
97         \textcolor{keywordflow}{return} isset($gf\_payment\_statuses[$status]) ? apply\_filters( \textcolor{stringliteral}{'edd\_gf\_payment\_status'}, 
      $gf\_payment\_statuses[$status], $status ) : apply\_filters( \textcolor{stringliteral}{'edd\_gf\_default\_status'}, \textcolor{stringliteral}{'pending'}, $status);
98     \}
\end{DoxyCode}
\hypertarget{class_k_w_s___g_f___e_d_d_a4d58c6b349b4a2dd52d509efb3300adc}{\index{K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D@{K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D}!init@{init}}
\index{init@{init}!KWS_GF_EDD@{K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D}}
\subsubsection[{init}]{\setlength{\rightskip}{0pt plus 5cm}K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D\-::init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{class_k_w_s___g_f___e_d_d_a4d58c6b349b4a2dd52d509efb3300adc}
Include the admin script and non-\/admin hooks 
\begin{DoxyCode}
62                            \{
63 
64         include( EDD\_GF\_PLUGIN\_DIR . \textcolor{stringliteral}{'admin.php'} );
65 
66         \textcolor{comment}{// Run the EDD functionality}
67         add\_action(\textcolor{stringliteral}{"gform\_after\_submission"}, array( &$this, \textcolor{stringliteral}{'send\_purchase\_to\_edd'} ), PHP\_INT\_MAX, 2);
68     \}
\end{DoxyCode}
\hypertarget{class_k_w_s___g_f___e_d_d_a9b3c8c5490e780bed64e4ccbe9ce913c}{\index{K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D@{K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D}!send\-\_\-purchase\-\_\-to\-\_\-edd@{send\-\_\-purchase\-\_\-to\-\_\-edd}}
\index{send\-\_\-purchase\-\_\-to\-\_\-edd@{send\-\_\-purchase\-\_\-to\-\_\-edd}!KWS_GF_EDD@{K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D}}
\subsubsection[{send\-\_\-purchase\-\_\-to\-\_\-edd}]{\setlength{\rightskip}{0pt plus 5cm}K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D\-::send\-\_\-purchase\-\_\-to\-\_\-edd (
\begin{DoxyParamCaption}
\item[{}]{\$entry = {\ttfamily null}, }
\item[{}]{\$form}
\end{DoxyParamCaption}
)}}\label{class_k_w_s___g_f___e_d_d_a9b3c8c5490e780bed64e4ccbe9ce913c}
Take a G\-F submission and add a purcase to E\-D\-D.

This converts the G\-F submission to an E\-D\-D order.

G\-F\-Forms\-Model\-::get\-\_\-lead()  \hyperlink{class_k_w_s___g_f___e_d_d_a957f6050e92f37a0c11d9350a32accdd}{K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D\-::get\-\_\-edd\-\_\-data\-\_\-array\-\_\-from\-\_\-entry()}  \hyperlink{class_k_w_s___g_f___e_d_d_aa718a24cb749c979ed56e798a7e9ae52}{K\-W\-S\-\_\-\-G\-F\-\_\-\-E\-D\-D\-::get\-\_\-payment\-\_\-status\-\_\-from\-\_\-gf\-\_\-status()}  edd\-\_\-update\-\_\-payment\-\_\-status()  G\-F\-Common\-::to\-\_\-number()  edd\-\_\-insert\-\_\-payment()  edd\-\_\-insert\-\_\-payment\-\_\-note() 
\begin{DoxyParams}[1]{Parameters}
array & {\em \$entry} & G\-F Entry array \\
\hline
array & {\em \$form} & G\-F Form array \\
\hline
\end{DoxyParams}

\begin{DoxyCode}
330                                                                \{
331 
332         \textcolor{comment}{// We need to re-fetch the entry since the payment gateways}
333         \textcolor{comment}{// will have modified the entry since submitted by the user}
334         $entry = GFFormsModel::get\_lead($entry[\textcolor{stringliteral}{'id'}]);
335 
336         $this->r(array(\textcolor{stringliteral}{'$entry'} => $entry, \textcolor{stringliteral}{'$form'} => $form), \textcolor{keyword}{false}, \textcolor{stringliteral}{'$form and $entry in
       `send\_purchase\_to\_edd`, ('}.\_\_LINE\_\_.\textcolor{charliteral}{')'});
337 
338         $data = $this->\hyperlink{class_k_w_s___g_f___e_d_d_a957f6050e92f37a0c11d9350a32accdd}{get\_edd\_data\_array\_from\_entry}($entry, $form);
339 
340         $date = date( \textcolor{stringliteral}{'Y-m-d H:i:s'}, strtotime( $entry[\textcolor{stringliteral}{'payment\_date'}] ) );
341 
342 \textcolor{preprocessor}{    # Create the purchase array}
343 \textcolor{preprocessor}{}        $purchase\_data     = array(
344             \textcolor{stringliteral}{'price'}        => GFCommon::to\_number( $entry[\textcolor{stringliteral}{'payment\_amount'}] ), \textcolor{comment}{// Remove currency, commas}
345             \textcolor{stringliteral}{'post\_date'}    => $date,
346             \textcolor{stringliteral}{'purchase\_key'} => $entry[\textcolor{stringliteral}{'transaction\_id'}],
347             \textcolor{stringliteral}{'user\_id'}      => $data[\textcolor{stringliteral}{'user\_info'}][\textcolor{stringliteral}{'id'}],
348             \textcolor{stringliteral}{'user\_email'}   => $data[\textcolor{stringliteral}{'user\_info'}][\textcolor{stringliteral}{'email'}],
349             \textcolor{stringliteral}{'user\_info'}    => $data[\textcolor{stringliteral}{'user\_info'}],
350             \textcolor{stringliteral}{'currency'}     => $entry[\textcolor{stringliteral}{'currency'}],
351             \textcolor{stringliteral}{'downloads'}    => $data[\textcolor{stringliteral}{'downloads'}],
352             \textcolor{stringliteral}{'cart\_details'} => $data[\textcolor{stringliteral}{'cart\_details'}],
353             #\textcolor{stringliteral}{'transaction\_type'} => $entry[\textcolor{stringliteral}{'transaction\_type'}],
354             #\textcolor{stringliteral}{'discount'}    => $data[\textcolor{stringliteral}{'discount\_codes'}], \textcolor{comment}{// TODO: Figure out discount code integration}
355             \textcolor{stringliteral}{'status'}       => \textcolor{stringliteral}{'pending'} \textcolor{comment}{// start with pending so we can call the update function, which
       logs all stats}
356         );
357 
358         \textcolor{comment}{// Add the payment}
359         $payment\_id = edd\_insert\_payment( $purchase\_data );
360 
361         \textcolor{comment}{// Record the GF Entry}
362         edd\_insert\_payment\_note( $payment\_id, sprintf( \_\_( \textcolor{stringliteral}{'<a href="%s">View Gravity Forms Entry</a>'}, \textcolor{stringliteral}{'
      edd-gf'} ), admin\_url( sprintf(\textcolor{stringliteral}{'admin.php?page=gf\_entries&amp;view=entry&amp;id=%d&amp;lid=%d'}, $form[\textcolor{stringliteral}{'id'}], 
      $entry[\textcolor{stringliteral}{'id'}] )) ));
363 
364         \textcolor{comment}{// Make sure GF and EDD have statuses that mean the same things.}
365         $status = $this->\hyperlink{class_k_w_s___g_f___e_d_d_aa718a24cb749c979ed56e798a7e9ae52}{get\_payment\_status\_from\_gf\_status}($entry[\textcolor{stringliteral}{'
      payment\_status'}]);
366 
367         \textcolor{comment}{// increase stats and log earnings}
368         edd\_update\_payment\_status( $payment\_id, $status) ;
369 
370         $this->r($purchase\_data, \textcolor{keyword}{true}, \textcolor{stringliteral}{'Purchase Data - Line ('}.\_\_LINE\_\_.\textcolor{charliteral}{')'});
371     \}
\end{DoxyCode}


The documentation for this class was generated from the following file\-:\begin{DoxyCompactItemize}
\item 
edd-\/gravity-\/forms.\-php\end{DoxyCompactItemize}
